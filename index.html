<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Socket.io Channel Management</title>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
</head>
<body>
    <h1>Socket.io Channel Management</h1>
    
    <div>
        <h2>Create Channel</h2>
        <form id="createChannelForm">
            <label for="createToken">JWT Token:</label>
            <input type="text" id="createToken" required><br>

            <label for="createChannel">Channel Name:</label>
            <input type="text" id="createChannel" required><br>

            <label for="createMaxCount">Max Count:</label>
            <input type="number" id="createMaxCount" required><br>

            <button type="submit">Create Channel</button>
        </form>
    </div>

    <div>
        <h2>Join Channel</h2>
        <form id="joinChannelForm">
            <label for="joinToken">JWT Token:</label>
            <input type="text" id="joinToken" required><br>

            <label for="joinChannel">Channel Name:</label>
            <input type="text" id="joinChannel" required><br>

            <button type="submit">Join Channel</button>
        </form>
    </div>

    <div id="messages"></div>

    <script>
        const serverUrl = "https://localhost"; // 서버 URL을 이곳에 명시하세요

        document.getElementById('createChannelForm').addEventListener('submit', (event) => {
            event.preventDefault();
            const token = document.getElementById('createToken').value;
            const channel = document.getElementById('createChannel').value;
            const maxCount = document.getElementById('createMaxCount').value;

            const socket = io(serverUrl, {
                auth: {
                    token: token
                }
            });

            socket.emit('createion', { MaxCount: maxCount, channel: channel });

            socket.on('channelCreated', (data) => {
                const messages = document.getElementById('messages');
                messages.innerHTML += `<p>${data.message}</p>`;
            });

            socket.on('error', (data) => {
                const messages = document.getElementById('messages');
                messages.innerHTML += `<p>Error: ${data.message}</p>`;
            });
        });

        document.getElementById('joinChannelForm').addEventListener('submit', (event) => {
            event.preventDefault();
            const token = document.getElementById('joinToken').value;
            const channel = document.getElementById('joinChannel').value;

            const socket = io(serverUrl, {
                auth: {
                    token: token
                }
            });

            socket.emit('joinChannel', { channel: channel });

            socket.on('message', (data) => {
                const messages = document.getElementById('messages');
                messages.innerHTML += `<p>${data.nickname}: ${data.message} (${data.currentTime})</p>`;
            });

            socket.on('error', (data) => {
                const messages = document.getElementById('messages');
                messages.innerHTML += `<p>Error: ${data.message}</p>`;
            });
        });
    </script>
</body>
</html>
